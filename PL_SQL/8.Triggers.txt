PL/SQL - Triggers
Triggers are stored programs, which are automatically executed or fired when some events occur.

Types of Triggers in Oracle
Triggers can be classified based on the following parameters.
1.Classification based on the timing
	BEFORE Trigger: It fires before the specified event has occurred.
	AFTER Trigger: It fires after the specified event has occurred.
	INSTEAD OF Trigger: "INSTEAD OF trigger" is the special type of 	trigger. It is used only in DML triggers. It is used when any DML 	event is going to occur on the complex 	view.
2.Classification based on the level
	STATEMENT level Trigger: It fires one time for the specified event statement.
	ROW level Trigger: It fires for each record that got affected in the specified event. 			(only for DML) 
3.Classification based on the Event
	1.DML Trigger: It fires when the DML event is specified (INSERT/UPDATE/DELETE)
	2.DDL Trigger: It fires when the DDL event is specified (CREATE/ALTER)
	3.DATABASE Trigger: It fires when the database event is specified 		(LOGON/LOGOFF/STARTUP/SHUTDOWN)

Benefits of Triggers
1.Generating some derived column values automatically 
2.Enforcing referential integrity
3.Event logging and storing information on table access 
4.Auditing
5.Synchronous replication of tables
6.Imposing security authorizations
7.Preventing invalid transactions

Syntax for creating a trigger:-
CREATE [ OR REPLACE ] TRIGGER <trigger_name>
[BEFORE | AFTER | INSTEAD OF ] --Trigger Timing
[INSERT UPDATE | DELETE.....]  --Event
ON <name of underlying object>
[FOR EACH ROW]   --Row Level
[ WHEN <condition for trigger to get execute>]  --Conditional Clause
DECLARE
<Declaration part>
BEGIN
<Execution part>
EXCEPTION
<Exception handling part>
END;

:old and :new are pseudorecords referred to access row level data when using row level trigger.
1:old - refers to Old Value
2:new - refers to New value
For Below operation, respective old and new values:
1.INSERT-:old.value= NULL, :new value= post insert value 
2.DELETE-:old.value= Pre Delete value, :new value= null
3.UPDATE-:old.value= Pre update value, :new value= Post Update value

DDL triggers: Using the Data Definition Language (DDL) triggers, the Oracle DBA can automatically track all changes to the database, including changes to tables, indexes, and constraints. The data from this trigger is especially useful for change control for the Oracle DBA.

Syntax: CREATE [OR REPLACE] TRIGGER trigger name
{BEFORE | AFTER } { DDL event} ON {DATABASE | SCHEMA} [WHEN (...)]
DECLARE
Variable declarations
BEGIN
...some code...
END;

DML  Example:
create or replace trigger display_salary_Changes
before 
delete or insert or update on employee
for each row
when(new.empno>0)
declare
	sal_diff number;
begin
	sal_diff:= :new.sal - :old.sal;
	dbms_output.put_line('Old Salary : '|| :old.sal);
	dbms_output.put_line('New Salary : '|| :new.sal);
	dbms_output.put_line('Salary Difference : '|| sal_diff);
end;
/

Output :
insert into employee(empno,ename,sal) values(1000,'Nuthan',1500);
Old Salary :
New Salary : 1500
Salary Difference :

update employee set sal=9999 where empno=1000;
Old Salary : 1500
New Salary : 9999
Salary Difference : 8499

Example : insert into employee 

DML Example:

create table audits(
audit_id number generated by default as identity primary key,
table_name varchar(50),
transaction_name varchar2(10),
by_user varchar2(15),
transaction_date date
);

create or replace trigger emp_audit_tag
	after update or delete on employee
	for each row
declare
	l_transaction varchar2(10);
begin
	l_transaction :=case
		when updating then 'update'
		when deleting then 'delete'
	end;
	
	insert into audits(table_name,transaction_name, by_user,transaction_date)
	values('Employee',l_transaction,user,sysdate);
end;
/

Output:
update employee set sal=9999 where empno=1000;
Old Salary : 1500
New Salary : 9999
Salary Difference : 8499

select * from audits;

  AUDIT_ID TABLE_NAME                      TRANSACTIO BY_USER         TRANSACTI
---------- -------------------------------------------------- ---------- --------------- ---------
         1 Employee                                           delete     SYSTEM          10-FEB-25
       281 Employee                                           update     SYSTEM          29-APR-25
       286 Employee                                           update     SYSTEM          29-APR-25
       287 Employee                                           update     SYSTEM          29-APR-25

Example DDL triggers script for DDL auditing:

create table audit_ddl (
d date,
osuser varchar2(255),
current_user varchar2(255),
host varchar2(255),
terminal varchar2(255),
owner varchar2(30),
type varchar2(30),
name varchar2(30),
sysevent varchar2(30));

create or replace trigger audit_ddl__trg after ddl on schema
begin
if (ora_sysevent='truncate')
then
null; --i do not care about truncate
else
insert into audit_ddl(d, osuser, current_user, host, terminal, owner, type, name, sysevent) values(
sysdate,
sys_context('userenv', 'os_user'),
sys_context('userenv', 'current_user'),
sys_context('userenv', 'host'),
sys_context('userenv', 'terminal'),
ora_dict_obj_owner,
ora_dict_obj_type,
ora_dict_obj_name,
ora_sysevent
);
end if;
end;
/
Output :
create table new123(sno number);
select * from audit_ddl;

29-APR-25  DATAPRO\dataro  SYSTEM  WORKGROUP\DATAPRO DATAPRO SYSTEM TABLE       NEW123  CREATE
29-APR-25 DATAPRO\dataro SYSTEM  WORKGROUP\DATAPRO  DATAPRO SYSTEM  TABLE       NEW123  ALTER